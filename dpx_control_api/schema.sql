DROP TABLE IF EXISTS user;
DROP TABLE IF EXISTS measurement;
DROP TABLE IF EXISTS totmode;
DROP TABLE IF EXISTS dosimode;
DROP TABLE IF EXISTS integrationmode;
DROP TABLE IF EXISTS config;

CREATE TABLE user (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    name TEXT UNIQUE NOT NULL
);

CREATE TABLE measurement (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    dosepix_id INTEGER NOT NULL,
    user_id INTEGER NOT NULL,
    mode TEXT NOT NULL,
    created TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (dosepix_id) REFERENCES config (id),
    FOREIGN KEY (user_id) REFERENCES user (id)
);

CREATE TABLE totmode (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    measurement_id INTEGER NOT NULL,
    frame_id INTEGER NOT NULL,
    pixel_id INTEGER NOT NULL,
    value INTEGER NOT NULL,
    FOREIGN KEY (measurement_id) REFERENCES measurement (id)
);

CREATE TABLE dosimode (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    measurement_id INTEGER NOT NULL,
    frame_id INTEGER NOT NULL,
    bin0 INTEGER NOT NULL,
    bin1 INTEGER NOT NULL,
    bin2 INTEGER NOT NULL,
    bin3 INTEGER NOT NULL,
    bin4 INTEGER NOT NULL,
    bin5 INTEGER NOT NULL,
    bin6 INTEGER NOT NULL,
    bin7 INTEGER NOT NULL,
    bin8 INTEGER NOT NULL,
    bin9 INTEGER NOT NULL,
    bin10 INTEGER NOT NULL,
    bin11 INTEGER NOT NULL,
    bin12 INTEGER NOT NULL,
    bin13 INTEGER NOT NULL,
    bin14 INTEGER NOT NULL,
    bin15 INTEGER NOT NULL,
    FOREIGN KEY (measurement_id) REFERENCES measurement (id)
);

CREATE TABLE integrationmode (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    measurement_id INTEGER NOT NULL,
    frame_id INTEGER NOT NULL,
    pixel_id INTEGER NOT NULL,
    value INTEGER NOT NULL,
    FOREIGN KEY (measurement_id) REFERENCES measurement (id)
);

CREATE TABLE config (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    dosepix_id INTEGER NOT NULL,
    user_id INTEGER NOT NULL,
    created TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    v_casc_preamp INTEGER NOT NULL DEFAULT 130,
    i_krum INTEGER NOT NULL DEFAULT 66,
    v_casc_reset INTEGER NOT NULL DEFAULT 220,
    i_pixeldac INTEGER NOT NULL DEFAULT 49,
    i_tpbufin INTEGER NOT NULL DEFAULT 128,
    v_tpref_fine INTEGER NOT NULL DEFAULT 100,
    v_gnd INTEGER NOT NULL DEFAULT 80,
    i_disc2 INTEGER NOT NULL DEFAULT 118,
    i_disc1 INTEGER NOT NULL DEFAULT 48,
    i_preamp INTEGER NOT NULL DEFAULT 100,
    v_tha INTEGER NOT NULL DEFAULT 5271,
    v_tpref_coarse INTEGER NOT NULL DEFAULT 255,
    i_tpbufout INTEGER NOT NULL DEFAULT 128,
    v_fbk INTEGER NOT NULL DEFAULT 200,
    confbits TEXT NOT NULL DEFAULT '00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000',
    pixeldac TEXT NOT NULL DEFAULT '00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000',
    OMROperationMode TEXT NOT NULL DEFAULT 'DosiMode',
    OMRGlobalShutter TEXT NOT NULL DEFAULT 'ClosedShutter',
    OMRPLL TEXT NOT NULL DEFAULT 'f100MHz',
    OMRPolarity TEXT NOT NULL DEFAULT 'hole',
    OMRAnalogOutSel TEXT NOT NULL DEFAULT 'High_Z',
    OMRAnalogInSel TEXT NOT NULL DEFAULT 'V_no',
    OMRDisableColClkGateType TEXT NOT NULL DEFAULT 'Enabled',
    OMRConfBits TEXT NOT NULL DEFAULT 'MaskBit',
    FOREIGN KEY (user_id) REFERENCES user (id)
);
